% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stat-tune.R
\name{wass2s_tune_pred_stat}
\alias{wass2s_tune_pred_stat}
\title{Tune and refit a single product/model, select configuration by KGE}
\usage{
wass2s_tune_pred_stat(
  df_basin_product,
  predictors,
  target = "Q",
  date_col = "YYYY",
  model = c("pcr", "ridge", "lasso"),
  prediction_years = NULL,
  target_positive = TRUE,
  resamples = NULL,
  pretrained_wflow = NULL,
  grid = NULL,
  min_predictors = 1,
  min_data_required = 10,
  init_frac = 0.6,
  assess_frac = 0.2,
  n_splits = NULL,
  cumulative = TRUE,
  quiet = TRUE,
  allow_par = TRUE,
  verbose_tune = TRUE,
  max_na_frac = 0.3,
  impute = "median",
  require_variance = TRUE,
  ...
)
}
\arguments{
\item{df_basin_product}{Data frame for a single basin/product with columns
`YYYY`, `Q`, and predictor columns.}

\item{predictors}{Character vector of predictor column names.}

\item{target}{Name of the target column (default: `"Q"`).}

\item{date_col}{Name of the date column (default: `"YYYY"`).}

\item{model}{One of `"pcr"`, `"ridge"`, `"lasso"`.}

\item{prediction_years}{Optional numeric vector of length 2 giving the
start and end years for a holdout prediction period. These years
are excluded from training and predictions are generated after fitting.}

\item{target_positive}{Logical; if TRUE, force negative predictions to zero.}

\item{resamples}{Optional \code{rsample::rset} object for resampling.
If \code{NULL}, a rolling-origin resampling is created via
\code{make_rolling()}.}

\item{pretrained_wflow}{Optional \code{workflows::workflow} object.
If supplied, tuning is skipped and the workflow is fitted directly.}

\item{grid}{Optional tibble of tuning parameters. If supplied, this grid
is used instead of the default grid for the specified model.}

\item{min_predictors}{Minimum number of predictors required to keep a product.}

\item{min_data_required}{Minimum number of rows required to train.}

\item{init_frac}{Fraction of rows used for the initial training window.}

\item{assess_frac}{Fraction of rows used for the assessment window.}

\item{n_splits}{Optional integer, desired number of resamples (splits).}

\item{cumulative}{Logical; passed to \code{rsample::rolling_origin()}.}

\item{quiet}{Logical; if \code{FALSE}, emits informative messages.}

\item{allow_par}{A logical to allow parallel processing (if a parallel backend is registered).}

\item{verbose_tune}{A logical for logging results (other than warnings and errors, which are always shown) as they are generated during training in a single R process.}

\item{max_na_frac}{Numeric in \eqn{[0, 1]}: maximum allowed fraction of missing
values per column before stopping (default \code{0.20} = 20\%).}

\item{impute}{Character, one of \code{"median"}, \code{"mean"}, or \code{"none"}.
If \code{"none"}, no imputation is performed after the guard (default \code{"median"}).}

\item{require_variance}{Logical; if \code{TRUE}, stop when a column has zero
standard deviation after imputation (default \code{TRUE}).}

\item{...}{Others parameters passed to \code{tune::control_grid()}}
}
\value{
A list with:
  \itemize{
    \item `kge_cv_mean` (numeric): mean KGE across splits for the best config.
    \item `preds` (tibble): columns `YYYY`, `pred` from the refitted model.
    \item `leaderboard_cfg` (tibble): per-config mean KGE, descending.
  }
}
\description{
Performs rolling-origin resampling, tunes hyperparameters (PCR threshold
or glmnet penalty), collects predictions, computes KGE per split, and
selects the configuration with best mean KGE (falls back to RMSE when needed).
}
\examples{
\dontrun{
res <- wass2s_tune_pred_stat(df, c("pt_1","pt_2","pt_3"), "ridge")
}
}
\seealso{
[make_recipe()], [make_rolling()], [wf_pcr()], [wf_ridge()], [wf_lasso()]
}
