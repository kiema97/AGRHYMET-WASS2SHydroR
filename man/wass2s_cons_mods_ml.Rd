% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hydro-fuse.R
\name{wass2s_cons_mods_ml}
\alias{wass2s_cons_mods_ml}
\title{Consolidate top-K products for one basin and one ML model}
\usage{
wass2s_cons_mods_ml(
  data_by_product,
  basin_id,
  hybas_id = "HYBAS_ID",
  target = "Q",
  date_col = "YYYY",
  pred_pattern_by_product = NULL,
  model = SUPPORTED_MODELS,
  topK = 3,
  min_kge_model = -Inf,
  pretrained = NULL,
  grid_levels = 5,
  min_data_required = 10,
  predictors_min = 3,
  quiet = TRUE,
  verbose = TRUE,
  max_na_frac = 0.3,
  impute = "median",
  require_variance = TRUE,
  ...
)
}
\arguments{
\item{data_by_product}{Named list of data frames/tibbles per product.}

\item{basin_id}{Basin identifier value.}

\item{hybas_id}{Name of the basin ID column (default: "HYBAS_ID").}

\item{target}{Name of the target column (default: "Q").}

\item{date_col}{Name of the date column (default: "YYYY").}

\item{pred_pattern_by_product}{Optional named list of regex by product to select predictors.}

\item{model}{One of `SUPPORTED_MODELS`.}

\item{topK}{Integer; number of best products to fuse (default: 3).}

\item{min_kge_model}{Minimum KGE threshold to accept fusion (default: -Inf).}

\item{pretrained}{Optional list of pre-trained models (indexed by `model` then product).}

\item{grid_levels}{Tuning grid granularity.}

\item{min_data_required}{Minimum number of rows required to train.}

\item{predictors_min}{Minimum number of predictors required.}

\item{quiet}{Logical; if FALSE, emits informative messages (default: TRUE).}

\item{verbose}{Logical, emit diagnostic messages.}

\item{max_na_frac}{Numeric in \eqn{[0, 1]}: maximum allowed fraction of missing
values per column before stopping (default \code{0.20} = 20\%).}

\item{impute}{Character, one of \code{"median"}, \code{"mean"}, or \code{"none"}.
If \code{"none"}, no imputation is performed after the guard (default \code{"median"}).}

\item{require_variance}{Logical; if \code{TRUE}, stop when a column has zero
standard deviation after imputation (default \code{TRUE}).}

\item{...}{Passed to the underlying tuner/predictor.}
}
\value{
A list with elements:
  \item{fused}{Fused predictions (or NULL if fusion is aborted).}
  \item{leaderboard_products}{Tibble of products and their KGE.}
  \item{all_results}{Raw list of per-product results.}
}
\description{
For a given basin and ML model, this function (i) fits/tunes the model
on each product, (ii) ranks products by cross-validated KGE, (iii) keeps
the top-K, and (iv) fuses their predictions via performance-weighted
averaging (weights derived from KGE).
}
