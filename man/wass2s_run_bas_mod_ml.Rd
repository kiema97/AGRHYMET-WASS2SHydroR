% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hydro-pipeline.R
\name{wass2s_run_bas_mod_ml}
\alias{wass2s_run_bas_mod_ml}
\title{Train all selected ML models for one basin and perform final fusion}
\usage{
wass2s_run_bas_mod_ml(
  data_by_product,
  basin_id,
  prediction_years = NULL,
  target = "Q",
  date_col = "YYYY",
  hybas_id = "HYBAS_ID",
  pred_pattern_by_product = NULL,
  models = SUPPORTED_MODELS,
  topK = 3,
  min_kge_model = -Inf,
  grid_levels = 5,
  final_fuser = "rf",
  quiet = TRUE,
  verbose_tune = TRUE,
  ...
)
}
\arguments{
\item{data_by_product}{Named list of data frames (one per product).}

\item{basin_id}{Basin identifier value.}

\item{prediction_years}{Optional numeric vector of length 2 giving the
start and end years for a holdout prediction period. These years}

\item{target}{Name of the target column (default: `"Q"`).}

\item{date_col}{Name of the date column (default: `"YYYY"`).}

\item{hybas_id}{Name of the basin ID column.}

\item{pred_pattern_by_product}{Optional per-product regex to select predictors.}

\item{models}{Character vector of base models to run (subset of \code{SUPPORTED_MODELS}).}

\item{topK}{Integer, number of best products per base model (default: 3).}

\item{min_kge_model}{Minimum best KGE required to keep a base model for the basin.}

\item{grid_levels}{Grid density for tuning both base models and meta-learner.}

\item{final_fuser}{Name of the meta-learner to use (subset of \code{SUPPORTED_FUSERS}).}

\item{quiet}{Logical; if \code{FALSE}, emits informative messages.}

\item{verbose_tune}{A logical for logging results (other than warnings and errors, which are always shown) as they are generated during training in a single R process.}

\item{...}{Passed to \code{WASS2SHydroR::wass2s_cons_mods_ml}.}
}
\value{
A list with:
\itemize{
  \item \code{fused_by_model}: tibble with \code{YYYY}, \code{Q}, and consolidated columns per model,
  \item \code{final_test}: tibble for the test year with \code{pred_final},
  \item \code{scores}: tibble with \code{HYBAS_ID}, \code{kge_final}, \code{rmse_final},
  \item \code{leaderboards}: list of product leaderboards per model.
  \item \code{cv_rs}: resampling results (or NULL if not applicable)
}
}
\description{
For a given basin, consolidate each chosen base model across products (top-K
weighted fusion), then train a meta-learner on the consolidated columns to
produce the final prediction for the last year.
}
\examples{
# wass2s_run_bas_mod_ml(basin_id = 1, data_by_product = lst, models = c("rf","xgb"))
}
