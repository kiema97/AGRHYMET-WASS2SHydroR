% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stat-fuse.R
\name{wass2s_cons_mods_stat}
\alias{wass2s_cons_mods_stat}
\title{Consolidate predictions across products for one model}
\usage{
wass2s_cons_mods_stat(
  basin_id,
  data_by_product,
  basin_col = "HYBAS_ID",
  pred_pattern_by_product = NULL,
  model = c("pcr", "ridge", "lasso"),
  topK = 3,
  min_kge_model = 0.2,
  min_predictors = 2,
  prediction_years = NULL,
  target_positive = FALSE,
  resamples = NULL,
  pretrained_wflow = NULL,
  grid = NULL,
  init_frac = 0.6,
  assess_frac = 0.2,
  n_splits = NULL,
  cumulative = TRUE,
  quiet = TRUE,
  verbose = TRUE,
  ...
)
}
\arguments{
\item{basin_id}{Basin identifier.}

\item{data_by_product}{Named list of data frames (one per product).}

\item{basin_col}{Column name for basin IDs (default: `"HYBAS_ID"`).}

\item{pred_pattern_by_product}{Named character vector: product -> regex for predictors.}

\item{model}{One of `"pcr"`, `"ridge"`, `"lasso"`.}

\item{topK}{Integer, number of products to keep.}

\item{min_kge_model}{Minimum KGE threshold to accept fusion (default: 0.2).}

\item{min_predictors}{Minimum number of predictors required to keep a product.}

\item{prediction_years}{Optional numeric vector of length 2 giving the
start and end years for a holdout prediction period. These years
are excluded from training and predictions are generated after fitting.}

\item{target_positive}{Logical; if TRUE, force negative predictions to zero.}

\item{resamples}{Optional \code{rsample::rset} object for resampling.
If \code{NULL}, a rolling-origin resampling is created via
\code{make_rolling()}.}

\item{pretrained_wflow}{Optional \code{workflows::workflow} object.
If supplied, tuning is skipped and the workflow is fitted directly.}

\item{grid}{Optional tibble of tuning parameters. If supplied, this grid
is used instead of the default grid for the specified model.}

\item{init_frac}{Fraction of rows used for the initial training window.}

\item{assess_frac}{Fraction of rows used for the assessment window.}

\item{n_splits}{Optional integer, desired number of resamples (splits).}

\item{cumulative}{Logical; passed to \code{rsample::rolling_origin()}.}

\item{quiet}{Logical; if \code{FALSE}, emits informative messages.}

\item{verbose}{Logical, emit diagnostic messages.}

\item{...}{Additional arguments passed to \code{wass2s_tune_pred_stat}.}
}
\value{
A list with:
  \itemize{
    \item `fused` (tibble): columns `YYYY`, `pred_fused`.
    \item `leaderboard_products` (tibble): product, KGE, counts, weights.
    \item `all_results` : list of all individual product results.
  }
}
\description{
For a given basin and a fixed statistical model (PCR/Ridge/Lasso), tunes and
predicts for each product, ranks products by KGE, keeps the top-K, and fuses
them using normalized KGE-based weights (with safeguards and fallbacks).
}
\examples{
\dontrun{
cns <- wass2s_cons_mods_stat(1040021500, data_by_product, model = "pcr", topK = 3)
}
}
