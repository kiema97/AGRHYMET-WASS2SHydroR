% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/models.R
\name{make_recipe}
\alias{make_recipe}
\title{Build a modeling recipe with cleaning, correlation filtering, normalization, and optional PCA}
\usage{
make_recipe(
  df,
  predictors,
  target = "Q",
  corr_threshold = 0,
  corr_method = "pearson",
  impute_nominal = TRUE,
  include_dummy = FALSE,
  y_transform = c("none", "log1p", "yeo"),
  pca_num_comp = NULL,
  pca_var_threshold = NULL,
  remove_linear_comb = TRUE,
  auto_pca = TRUE,
  auto_pca_when_gt = 15,
  auto_pca_var_threshold = 0.8,
  verbose = FALSE
)
}
\arguments{
\item{df}{A data frame or tibble containing \code{target} and \code{predictors}.}

\item{predictors}{Character vector of predictor column names. Nonexistent names
are dropped silently; an error is thrown if none remain.}

\item{target}{Character scalar; outcome column name (annual mean discharge).
Must be numeric. Default: \code{"Q"}.}

\item{corr_threshold}{Numeric in (0, 1); absolute correlation threshold used
by \code{recipes::step_corr()}. Default: \code{0.90}.}

\item{corr_method}{Correlation method for \code{step_corr()}, typically
\code{"pearson"} (default) or \code{"spearman"}.}

\item{impute_nominal}{Logical; if \code{TRUE}, apply \code{step_impute_mode()}
to nominal predictors. Default: \code{TRUE}.}

\item{include_dummy}{Logical; if \code{TRUE}, expand nominal predictors via
\code{step_dummy(one_hot = TRUE, keep_original_cols = FALSE)} before
correlation filtering. Default: \code{FALSE}.}

\item{y_transform}{Character; one of \code{"none"} (default), \code{"log1p"}
(applies \code{log(Q + 1)}) or \code{"yeo"} (Yeoâ€“Johnson) for the outcome.
The outcome is left untransformed by default.}

\item{pca_num_comp}{Integer or \code{NULL}; if provided, apply PCA with a fixed
number of components (disables auto-PCA).}

\item{pca_var_threshold}{Numeric or \code{NULL}; if provided (e.g. \code{0.95}),
apply PCA keeping enough components to reach the cumulative explained variance
threshold (disables auto-PCA). Do not set together with \code{pca_num_comp}.}

\item{remove_linear_comb}{Logical; if \code{TRUE} (default), remove linear
combinations using \code{step_lincomb()}.}

\item{auto_pca}{Logical; if \code{TRUE}, enable automatical PCA. Default: \code{TRUE}.}

\item{auto_pca_when_gt}{Integer; enable auto-PCA when the number of predictors
is greater than this threshold. Default: \code{15}.}

\item{auto_pca_var_threshold}{Numeric in (0, 1); cumulative variance target used
when auto-PCA is triggered. Default: \code{0.95}.}

\item{verbose}{Logical; if \code{TRUE}, emit informational messages.
Default: \code{FALSE}.}
}
\value{
An unprepped \code{recipes::recipe} object suitable for use inside
  \pkg{workflows}/\pkg{tune}.
}
\description{
Construct a robust \pkg{recipes} pipeline for a **numeric outcome** (annual mean
discharge). The recipe assigns roles, removes zero/near-zero variance predictors,
imputes missing values (median for numeric, optional mode for nominal),
optionally removes linear combinations, filters highly correlated predictors,
normalizes numeric predictors, and can apply PCA either explicitly or
**automatically when the number of predictors exceeds a threshold**.
}
\details{
Typical step order: \emph{imputation} \eqn{\rightarrow} (optional) \emph{dummy encoding}
\eqn{\rightarrow} \emph{correlation filtering} \eqn{\rightarrow} \emph{normalization}
\eqn{\rightarrow} (optional) \emph{PCA}. Correlation is computed after imputation.
Normalization does not affect pairwise correlation but is required before PCA.
}
\section{Behavior}{

If neither \code{pca_num_comp} nor \code{pca_var_threshold} is set, the function
will automatically enable PCA when \code{length(predictors) > auto_pca_when_gt},
keeping enough components to reach \code{auto_pca_var_threshold} cumulative variance.
If either \code{pca_num_comp} or \code{pca_var_threshold} is provided, this explicit
setting takes precedence and auto-PCA is disabled.
}

\examples{
\dontrun{
# Minimal example
rec <- make_recipe(
  df = data,
  predictors = c("x1","x2","x3","region"),
  target = "Q",
  corr_threshold = 0.9,
  include_dummy = TRUE
)
rec_prep <- recipes::prep(rec)

# Force PCA to 10 components (disables auto-PCA)
rec_pca_fixed <- make_recipe(
  df = data,
  predictors = setdiff(names(data), "Q"),
  pca_num_comp = 10
)

# Keep 95\% cumulative variance via PCA (disables auto-PCA)
rec_pca_var <- make_recipe(
  df = data,
  predictors = setdiff(names(data), "Q"),
  pca_var_threshold = 0.95
)
}

}
\seealso{
\code{\link[recipes]{recipe}}, \code{\link[recipes]{step_corr}},
  \code{\link[recipes]{step_pca}}, \code{\link[workflows]{workflow}}
}
\concept{modeling utilities}
\keyword{internal}
