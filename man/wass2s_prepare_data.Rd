% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wass2s_prepare_data.R
\name{wass2s_prepare_data}
\alias{wass2s_prepare_data}
\title{Preprocess NetCDF/stars to tidy df (stars-first, multi-ref-time + temporal agg)}
\usage{
wass2s_prepare_data(
  x,
  bbox = NULL,
  spatial_reduce = c("none", "mean", "median", "min", "max"),
  cell_layout = c("long", "wide"),
  cell_prefix = "val",
  dim_lon = NULL,
  dim_lat = NULL,
  dim_time = NULL,
  dim_ref_time = NULL,
  dim_period = NULL,
  dim_member = NULL,
  ensemble_reduce = c("mean", "median", "min", "max", "none"),
  verbose = TRUE
)
}
\arguments{
\item{x}{path to .nc or a `stars` object.}

\item{bbox}{optional numeric c(N, W, S, E) in lon/lat.}

\item{spatial_reduce}{"none","mean","median","min","max". Default "none".}

\item{cell_layout}{when spatial_reduce="none": "long" (default) or "wide".}

\item{cell_prefix}{prefix for wide columns. Default "val".}

\item{dim_lon, dim_lat, dim_time}{optional overrides for lon/lat/time dims.}

\item{dim_ref_time, dim_period}{optional overrides for ref-time & lead/period dims.}

\item{dim_member}{optional override for member/ensemble dim (e.g. "number").}

\item{ensemble_reduce}{"mean","median","min","max","none". Default "mean".}

\item{verbose}{print progress. Default TRUE.}
}
\value{
data.frame with DATE and values (shape depends on args).
}
\description{
This function keeps computations in `stars`/arrays as long as possible:
- optional bbox crop,
- optional ensemble aggregation on the member dimension,
- drops/averages any extra dims,
- reconstructs a single time dim T from (time|valid_time) or (forecast_reference_time + forecast_period),
- temporal aggregation on the (X,Y,T) cube: "year" (default), "month", or "none",
- optional spatial aggregation,
- finally returns a tidy `data.frame` (long or wide).
}
